name: Blockchain PoC

on:
  workflow_dispatch:
    inputs:
      enable:
        description: "Set to true to execute the blockchain PoC harness"
        required: false
        default: "false"

env:
  CARGO_TERM_COLOR: always

jobs:
  poc-tests:
    name: Blockchain integrity checks
    if: ${{ vars.BLOCKCHAIN_POC_ENABLED == 'true' || (github.event_name == 'workflow_dispatch' && github.event.inputs.enable == 'true') }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: 1.76.0
      - uses: Swatinem/rust-cache@v2
        with:
          shared-key: blockchain-poc
      - name: Show PoC configuration template
        run: cat tests/blockchain/config.example.toml
      - name: Run blockchain PoC tests
        env:
          PROPTEST_CASES: "32"
        run: cargo test -p aunsorm-tests --test blockchain_poc
